import{a as k}from"./chunk-BNY3LDWH.js";import{a as S}from"./chunk-PCYU5DIU.js";import"./chunk-37WAIENX.js";import"./chunk-LJ5XHLMQ.js";import{k as j,l as I,p as E}from"./chunk-ODFDANH7.js";import{Ab as u,Cb as h,Ha as c,Ma as x,Sa as y,Xa as _,ca as b,da as g,db as v,fb as M,kb as d,lb as s,nb as w,rb as C,sa as p,sb as m}from"./chunk-AWTQUO7P.js";import"./chunk-FK42CRUA.js";function T(a,t){if(a&1&&(d(0,"span"),u(1),s()),a&2){let e=m().$implicit;c(),h(" ",e.mina?"\u{1F4A3}":e.valor>0?e.valor:""," ")}}function F(a,t){a&1&&(d(0,"span"),u(1,"\u{1F6A9}"),s())}function O(a,t){if(a&1){let e=w();d(0,"div",8),C("click",function(){let i=b(e).index,o=m().index,r=m();return g(r.descubrir(o,i))})("contextmenu",function(i){let o=b(e).index,r=m().index,l=m();return g(l.alternarBandera(i,r,o))})("keydown",function(i){let o=b(e).index,r=m().index,l=m();return g(l.manejarTecla(i,r,o))}),_(1,T,2,1,"span",9)(2,F,2,0,"span",9),s()}if(a&2){let e=t.$implicit;M("revealed",e.revelada)("flagged",e.marcada),c(),v("ngIf",e.revelada),c(),v("ngIf",!e.revelada&&e.marcada)}}function P(a,t){if(a&1&&(d(0,"div",6),_(1,O,3,6,"div",7),s()),a&2){let e=t.$implicit;c(),v("ngForOf",e)}}function B(a,t){if(a&1&&(d(0,"div",10),u(1),s()),a&2){let e=m();c(),h(" ",e.mensajeFinal()," ")}}var D=class a{constructor(t,e){this.userService=t;this.puntajeService=e;this.preloadAudios(),this.iniciarJuego()}filas=9;columnas=9;totalMinas=10;tablero=p([]);tiempo=p(0);minasRestantes=p(this.totalMinas);juegoTerminado=p(!1);mensajeFinal=p(null);temporizadorId=null;audios={};ngOnDestroy(){this.temporizadorId&&clearInterval(this.temporizadorId)}preloadAudios(){["click-busca-minas","bandera-busca-minas","boom-busca-minas","win"].forEach(e=>{let n=new Audio(`assets/sounds/${e}.mp3`);n.load(),this.audios[e]=n})}reproducirSonido(t){let e=this.audios[t];e&&(e.currentTime=0,e.volume=.5,e.play().catch(n=>console.error("Error sonido:",n)))}iniciarJuego(){this.juegoTerminado.set(!1),this.mensajeFinal.set(null),this.tiempo.set(0),this.temporizadorId&&clearInterval(this.temporizadorId),this.temporizadorId=setInterval(()=>this.tiempo.update(n=>n+1),1e3);let t=Array.from({length:this.filas},()=>Array.from({length:this.columnas},()=>({mina:!1,valor:0,revelada:!1,marcada:!1}))),e=0;for(;e<this.totalMinas;){let n=Math.floor(Math.random()*this.filas),i=Math.floor(Math.random()*this.columnas);t[n][i].mina||(t[n][i].mina=!0,e++)}for(let n=0;n<this.filas;n++)for(let i=0;i<this.columnas;i++)t[n][i].mina||(t[n][i].valor=this.contarMinasAdyacentes(t,n,i));this.tablero.set(t),this.minasRestantes.set(this.totalMinas)}contarMinasAdyacentes(t,e,n){let i=0;for(let o of[-1,0,1])for(let r of[-1,0,1]){if(o===0&&r===0)continue;let l=e+o,f=n+r;this.estaEnRango(l,f)&&t[l][f].mina&&i++}return i}estaEnRango(t,e){return t>=0&&t<this.filas&&e>=0&&e<this.columnas}descubrir(t,e){if(this.juegoTerminado())return;let n=this.tablero(),i=n[t][e];i.revelada||i.marcada||(i.revelada=!0,i.mina?this.finalizarJuego(!1):(this.reproducirSonido("click-busca-minas"),i.valor===0&&this.descubrirVecinos(n,t,e),this.verificarVictoria()),this.tablero.set([...n]))}descubrirVecinos(t,e,n){for(let i of[-1,0,1])for(let o of[-1,0,1]){let r=e+i,l=n+o;if(this.estaEnRango(r,l)){let f=t[r][l];!f.revelada&&!f.mina&&!f.marcada&&(f.revelada=!0,f.valor===0&&this.descubrirVecinos(t,r,l))}}}alternarBandera(t,e,n){if(t.preventDefault(),this.juegoTerminado())return;let i=this.tablero(),o=i[e][n];o.revelada||(o.marcada=!o.marcada,this.reproducirSonido("bandera-busca-minas"),this.minasRestantes.update(r=>r+(o.marcada?-1:1)),this.tablero.set([...i]))}manejarTecla(t,e,n){t.key==="Enter"||t.key===" "?(t.preventDefault(),this.descubrir(e,n)):t.key.toLowerCase()==="f"&&(t.preventDefault(),this.alternarBandera(new MouseEvent("contextmenu"),e,n))}verificarVictoria(){let t=this.tablero();for(let e of t)for(let n of e)if(!n.mina&&!n.revelada)return;this.finalizarJuego(!0)}finalizarJuego(t){if(this.temporizadorId&&clearInterval(this.temporizadorId),this.juegoTerminado.set(!0),t){this.reproducirSonido("win"),this.mensajeFinal.set("\u{1F389} \xA1Ganaste! Todos los campos seguros fueron revelados.");let e=this.userService.getCurrentUser(),n=this.tiempo();e&&this.puntajeService.guardarPuntaje(e,"buscaminas",n)}else this.reproducirSonido("boom-busca-minas"),this.mensajeFinal.set("\u{1F4A5} \xA1Perdiste! Pisaste una mina.")}static \u0275fac=function(e){return new(e||a)(x(S),x(k))};static \u0275cmp=y({type:a,selectors:[["friki-club-busca-minas"]],decls:15,vars:4,consts:[[1,"wrapper","bg-white","p-4","rounded","shadow-lg"],[1,"top-bar","d-flex","justify-content-between","align-items-center","mb-3"],[1,"btn","btn-sm","btn-outline-primary",3,"click"],[1,"board"],["class","row d-flex justify-content-center",4,"ngFor","ngForOf"],["class","alert alert-info mt-3",4,"ngIf"],[1,"row","d-flex","justify-content-center"],["class","cell","tabindex","0","role","button",3,"revealed","flagged","click","contextmenu","keydown",4,"ngFor","ngForOf"],["tabindex","0","role","button",1,"cell",3,"click","contextmenu","keydown"],[4,"ngIf"],[1,"alert","alert-info","mt-3"]],template:function(e,n){e&1&&(d(0,"div",0)(1,"div",1)(2,"div")(3,"strong"),u(4,"\u{1F4A3}"),s(),u(5),s(),d(6,"div")(7,"strong"),u(8,"\u23F1\uFE0F"),s(),u(9),s(),d(10,"button",2),C("click",function(){return n.iniciarJuego()}),u(11,"\u{1F504} Reiniciar"),s()(),d(12,"div",3),_(13,P,2,1,"div",4),s(),_(14,B,2,1,"div",5),s()),e&2&&(c(5),h(" ",n.minasRestantes()," minas"),c(4),h(" ",n.tiempo(),"s"),c(4),v("ngForOf",n.tablero()),c(),v("ngIf",n.mensajeFinal()))},dependencies:[E,j,I],styles:[".wrapper[_ngcontent-%COMP%]{max-width:500px;margin:2rem auto;margin-top:8%}.board[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.row[_ngcontent-%COMP%]{display:flex;gap:2px}.cell[_ngcontent-%COMP%]{width:34px;height:34px;background:#343a40;color:#fff;border-radius:6px;display:flex;justify-content:center;align-items:center;cursor:pointer;font-weight:700;-webkit-user-select:none;user-select:none;transition:background .2s ease,transform .1s;outline:none}.cell[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.cell.revealed[_ngcontent-%COMP%]{background:#dee2e6;color:#212529}.cell.flagged[_ngcontent-%COMP%]{background-color:#6c757d}.cell[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 2px #0d6efd}.alert[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:500}"]})};export{D as BuscaMinasComponent};
