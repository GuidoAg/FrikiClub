import{p as F}from"./chunk-WJLNC4RZ.js";import{a as k}from"./chunk-GOHWGIN5.js";import{a as D}from"./chunk-BNY3LDWH.js";import{a as E}from"./chunk-FF7POJ4O.js";import"./chunk-37WAIENX.js";import"./chunk-LJ5XHLMQ.js";import{k as M,l as w,p as T}from"./chunk-ODFDANH7.js";import{Ab as c,Bb as y,Cb as f,Ea as P,Ha as a,Ma as g,Q as b,Sa as I,Tb as O,V as x,Xa as p,ca as m,cb as S,da as u,db as s,fb as j,kb as i,lb as r,nb as _,o as v,rb as C,sb as d}from"./chunk-AWTQUO7P.js";import"./chunk-FK42CRUA.js";var h=class n{constructor(t){this.http=t}API_URL="https://restcountries.com/v3.1/all?fields=name,flags,translations";getAllCountries(){return this.http.get(this.API_URL).pipe(v(t=>t.filter(e=>e.translations?.spa?.common&&e.flags?.svg&&e.flags.svg.trim()!=="").map(e=>({nombre:e.translations.spa.common,bandera:e.flags.svg}))))}static \u0275fac=function(e){return new(e||n)(x(k))};static \u0275prov=b({token:n,factory:n.\u0275fac,providedIn:"root"})};function A(n,t){if(n&1){let e=_();i(0,"img",13),C("load",function(){m(e);let l=d(2);return u(l.banderaCargadaHandler())})("error",function(){m(e);let l=d(2);return u(l.imagenFallida())}),r()}if(n&2){let e=d(2);s("src",e.paisCorrecto.bandera,P)("alt","Bandera de "+e.paisCorrecto.nombre)}}function H(n,t){n&1&&(i(0,"div",14),c(1," Cargando bandera... "),r())}function B(n,t){n&1&&(i(0,"div")(1,"p"),c(2,"Cargando bandera..."),r()())}function J(n,t){n&1&&(i(0,"span"),c(1,"\u2705"),r())}function N(n,t){n&1&&(i(0,"span"),c(1,"\u274C"),r())}function $(n,t){n&1&&(i(0,"span"),c(1,"\u23F1\uFE0F"),r())}function L(n,t){if(n&1&&(i(0,"div",15),p(1,J,2,0,"span",7)(2,N,2,0,"span",7)(3,$,2,0,"span",7),r()),n&2){let e=d(2);a(),s("ngIf",(e.respuestaSeleccionada==null?null:e.respuestaSeleccionada.nombre)===e.respuestaCorrecta.nombre),a(),s("ngIf",e.respuestaSeleccionada&&(e.respuestaSeleccionada==null?null:e.respuestaSeleccionada.nombre)!==e.respuestaCorrecta.nombre),a(),s("ngIf",!e.respuestaSeleccionada)}}function q(n,t){if(n&1&&(i(0,"div",16),c(1),r()),n&2){let e=d(2);a(),f(" \u23F3 ",e.tiempoRestante,"s ")}}function G(n,t){if(n&1){let e=_();i(0,"button",17),C("click",function(){let l=m(e).$implicit,z=d(2);return u(z.responder(l))}),c(1),r()}if(n&2){let e=t.$implicit,o=d(2);j("correcto",o.getClaseOpcion(e)==="correcto")("incorrecto",o.getClaseOpcion(e)==="incorrecto"),s("disabled",!o.esperandoRespuesta),S("aria-label","Opci\xF3n: "+e.nombre),a(),f(" ",e.nombre," ")}}function K(n,t){if(n&1&&(i(0,"div",3)(1,"h2"),c(2,"\xBFDe qu\xE9 pa\xEDs es esta bandera?"),r(),i(3,"div",4),p(4,A,1,2,"img",5)(5,H,2,0,"div",6)(6,B,3,0,"div",7)(7,L,4,3,"div",8),r(),p(8,q,2,1,"div",9),i(9,"div",10),p(10,G,2,7,"button",11),r(),i(11,"div",12)(12,"span"),c(13),r(),i(14,"span"),c(15),r()()()),n&2){let e=d();a(4),s("ngIf",e.paisCorrecto==null?null:e.paisCorrecto.bandera),a(),s("ngIf",!e.banderaCargada&&e.paisCorrecto),a(),s("ngIf",!e.banderaCargada&&e.paisCorrecto),a(),s("ngIf",e.respuestaCorrecta),a(),s("ngIf",!e.juegoTerminado),a(2),s("ngForOf",e.opciones),a(3),f("Puntaje: ",e.puntaje,""),a(2),f("Vidas: \u2764\uFE0F x",e.vidas,"")}}function Q(n,t){if(n&1){let e=_();i(0,"div",18)(1,"h3",19),c(2),r(),i(3,"button",20),C("click",function(){m(e);let l=d();return u(l.reiniciarJuego())}),c(4," \u{1F504} Jugar de nuevo "),r()()}if(n&2){let e=d();a(2),y(e.mensajeFinal)}}var R=class n{constructor(t,e,o,l){this.countryService=t;this.cd=e;this.userService=o;this.puntajeService=l}paises=[];paisesDisponibles=[];paisCorrecto=null;opciones=[];puntaje=0;vidas=3;mensaje="";juegoTerminado=!1;tiempoRestante=10;respuestaCorrecta=null;respuestaSeleccionada=null;timerInterval;mensajeFinal="";banderaCargada=!1;esperandoRespuesta=!1;ngOnInit(){this.countryService.getAllCountries().subscribe(t=>{this.paises=t.filter(e=>e.nombre&&e.bandera&&e.bandera.trim()!==""),this.preloadBanderaImgs(this.paises),this.paisesDisponibles=this.shuffle([...this.paises]),this.siguientePregunta()})}preloadBanderaImgs(t){t.forEach(e=>{let o=new Image;o.src=e.bandera})}banderaCargadaHandler(){this.banderaCargada=!0,this.esperandoRespuesta=!0,this.iniciarTemporizador(),this.cd.markForCheck()}imagenFallida(){console.warn("\u274C Fall\xF3 al cargar la imagen de:",this.paisCorrecto?.nombre),this.paises=this.paises.filter(t=>t.nombre!==this.paisCorrecto?.nombre),this.siguientePregunta()}reiniciarJuego(){this.puntaje=0,this.vidas=3,this.juegoTerminado=!1,this.respuestaCorrecta=null,this.respuestaSeleccionada=null,this.paisesDisponibles=this.shuffle([...this.paises]),this.siguientePregunta()}iniciarTemporizador(){this.tiempoRestante=10,this.timerInterval=setInterval(()=>{this.tiempoRestante--,this.tiempoRestante===0&&(clearInterval(this.timerInterval),this.responder(null)),this.cd.markForCheck()},1e3)}siguientePregunta(){if(this.juegoTerminado||this.paisesDisponibles.length<4)return;clearInterval(this.timerInterval),this.respuestaCorrecta=null,this.respuestaSeleccionada=null,this.esperandoRespuesta=!1,this.mensaje="",this.banderaCargada=!1,this.paisCorrecto=this.paisesDisponibles.pop();let t=new Set;for(t.add(this.paisCorrecto);t.size<4;){let e=this.paises[Math.floor(Math.random()*this.paises.length)];e&&e!==this.paisCorrecto&&t.add(e)}this.opciones=this.shuffle(Array.from(t)),this.cd.markForCheck()}responder(t){if(this.esperandoRespuesta){if(this.esperandoRespuesta=!1,clearInterval(this.timerInterval),this.respuestaSeleccionada=t??null,this.respuestaCorrecta=this.paisCorrecto,t?.nombre===this.paisCorrecto?.nombre)this.puntaje++;else if(this.vidas--,this.vidas<=0){this.juegoTerminado=!0,this.mensajeFinal=`\u{1F480} Juego terminado. Puntaje final: ${this.puntaje}`;let e=this.userService.getCurrentUser();e&&this.puntajeService.guardarPuntaje(e,"preguntados",this.puntaje),this.cd.markForCheck();return}this.cd.markForCheck(),setTimeout(()=>{this.juegoTerminado||this.siguientePregunta()},2e3)}}getClaseOpcion(t){return this.respuestaCorrecta?t.nombre===this.respuestaCorrecta.nombre?"correcto":this.respuestaSeleccionada?.nombre===t.nombre?"incorrecto":"":""}shuffle(t){return t.map(e=>({value:e,sort:Math.random()})).sort((e,o)=>e.sort-o.sort).map(({value:e})=>e)}static \u0275fac=function(e){return new(e||n)(g(h),g(O),g(E),g(D))};static \u0275cmp=I({type:n,selectors:[["friki-club-preguntados"]],decls:3,vars:2,consts:[[1,"wrapper","bg-white","p-4","rounded","shadow-lg","text-center"],["class","juego",4,"ngIf"],["class","mensaje-final mt-4 p-3 bg-danger-subtle rounded shadow-sm",4,"ngIf"],[1,"juego"],[1,"bandera-container"],["class","bandera",3,"src","alt","load","error",4,"ngIf"],["class","text-muted mt-2",4,"ngIf"],[4,"ngIf"],["class","icono-resultado",4,"ngIf"],["class","temporizador",4,"ngIf"],[1,"opciones"],["class","btn-opcion",3,"correcto","incorrecto","disabled","click",4,"ngFor","ngForOf"],[1,"info"],[1,"bandera",3,"load","error","src","alt"],[1,"text-muted","mt-2"],[1,"icono-resultado"],[1,"temporizador"],[1,"btn-opcion",3,"click","disabled"],[1,"mensaje-final","mt-4","p-3","bg-danger-subtle","rounded","shadow-sm"],[1,"text-danger"],[1,"btn","btn-primary","mt-2",3,"click"]],template:function(e,o){e&1&&(i(0,"div",0),p(1,K,16,8,"div",1)(2,Q,5,1,"div",2),r()),e&2&&(a(),s("ngIf",o.paisCorrecto),a(),s("ngIf",o.juegoTerminado))},dependencies:[T,M,w,F],styles:[".wrapper[_ngcontent-%COMP%]{max-width:600px;margin:3rem auto}.bandera-container[_ngcontent-%COMP%]{position:relative;display:inline-block;margin-bottom:1rem}.bandera-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;height:auto;border-radius:.5rem;transition:all .3s ease}.bandera-container[_ngcontent-%COMP%]   img.acierto[_ngcontent-%COMP%]{border:4px solid #28a745}.bandera-container[_ngcontent-%COMP%]   img.error[_ngcontent-%COMP%]{border:4px solid #dc3545}.bandera-container[_ngcontent-%COMP%]   .mensaje-final[_ngcontent-%COMP%]{margin-top:1rem;padding:1rem;background-color:#ffe5e5;border:2px solid #ff4d4d;border-radius:8px;color:#a30000;font-weight:700;text-align:center;font-size:1.2rem}.bandera-container[_ngcontent-%COMP%]   .icono-resultado[_ngcontent-%COMP%]{position:absolute;top:2rem;right:3rem;font-size:4rem}.temporizador[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:#ff5722;margin-bottom:1rem}.opciones[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;margin-bottom:1rem}.btn-opcion[_ngcontent-%COMP%]{padding:.75rem 1.25rem;font-size:1rem;border:none;border-radius:1rem;background-color:#007bff;color:#fff;cursor:pointer;transition:background .3s ease}.btn-opcion[_ngcontent-%COMP%]:hover:enabled{background-color:#0056b3}.btn-opcion.correcto[_ngcontent-%COMP%]{background-color:#28a745}.btn-opcion.incorrecto[_ngcontent-%COMP%]{background-color:#dc3545}.mensaje[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;margin:1rem 0}.info[_ngcontent-%COMP%]{display:flex;justify-content:space-around;font-size:1.1rem}.resultado-final[_ngcontent-%COMP%]{text-align:center;margin-top:3rem}.resultado-final[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:2rem}.resultado-final[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.75rem 1.25rem;font-size:1rem;background-color:#28a745;color:#fff;border:none;border-radius:1rem;cursor:pointer}"],changeDetection:0})};export{R as PreguntadosComponent};
